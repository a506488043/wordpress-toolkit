# WordPress Toolkit

**语言 / Language:** [中文](README.md) | [English](en.md)

一个功能强大、安全可靠的WordPress综合工具包，集成了四个实用工具模块，为网站提供全面的功能支持。

## 📋 基本信息

- **插件名称**: WordPress Toolkit
- **版本**: 1.0.5
- **作者**: www.saiita.com.cn
- **许可证**: GPL v2 or later
- **最低要求**: WordPress 5.0+, PHP 7.4+
- **测试兼容**: WordPress 6.4
- **插件地址**: https://www.saiita.com.cn

## 🛠️ 核心模块

### 🌐 网站卡片 (Custom Card)
**版本**: 1.0.3

自动抓取网站元数据并生成美观的卡片展示。

**核心功能**:
- ✅ **多源数据抓取**: 支持 Open Graph、Twitter Cards、Schema.org
- ✅ **智能缓存系统**: 三级缓存（数据库 → Memcached → Opcache）
- ✅ **SSRF 安全保护**: 完整的URL验证和安全检查
- ✅ **Gutenberg 集成**: 支持可视化编辑器区块
- ✅ **点击统计**: 详细的卡片访问数据统计
- ✅ **响应式设计**: 完美适配移动端和桌面端

**使用方法**:
```php
// 短代码调用
[custom_card url="https://example.com"]
[custom_card_lazy url="https://example.com"]

// PHP函数调用
echo do_shortcode('[custom_card url="https://example.com"]');
```

### 📅 年龄计算器 (Age Calculator)
**版本**: 1.0.3

精确计算年龄，对闰年2月29日进行特殊优化。

**核心功能**:
- ✅ **精确计算**: 使用PHP DateTime类处理复杂日期
- ✅ **闰年优化**: 完美处理2月29日生日
- ✅ **多种格式**: 支持年、月、天、详细显示格式
- ✅ **用户集成**: 与WordPress用户系统深度集成
- ✅ **记忆功能**: 为登录用户保存生日信息
- ✅ **交互模式**: 支持即时计算和表单模式

**使用方法**:
```php
// 显示完整计算器
[manus_age_calculator]

// 仅显示计算表单
[manus_age_calculator_form]

// 显示特定年龄
[manus_age_calculator date="1990-02-28"]
```

### 📦 物品管理 (Time Capsule)
**版本**: 1.0.6

记录和管理个人物品购买信息，追踪使用和保修状态。

**核心功能**:
- ✅ **物品档案**: 完整的物品信息管理系统
- ✅ **分类管理**: 支持多种物品类别（电子产品、家具、车辆等）
- ✅ **保修追踪**: 自动保修状态计算和到期提醒
- ✅ **使用统计**: 详细的使用时长和频率统计
- ✅ **数据导出**: 支持CSV和JSON格式导出
- ✅ **用户隔离**: 管理员和订阅者数据分离
- ✅ **多维筛选**: 按类别、状态、保修期、用户等筛选

**支持的物品类别**:
- 🚗 **交通工具** (汽车、摩托车、自行车等)
- 📱 **电子产品** (手机、电脑、家电等)
- 🪑 **家具用品** (沙发、床、桌子等)
- 👔 **服装鞋帽** (衬衫、裤子、鞋子等)
- 🍔 **食品饮料** (零食、饮料、调料等)
- 📚 **图书文具** (书籍、文具、办公用品等)
- ⚽ **体育用品** (健身器材、球类、户外装备等)

**使用方法**:
```php
// 显示物品列表和添加表单
[time_capsule]

// 显示单个物品详情
[time_capsule_item id="123"]

// 显示类别物品
[time_capsule category="Electronics"]
```

### 🍪 Cookie同意 (CookieGuard)
**版本**: 1.0.3

符合GDPR要求的专业Cookie同意通知系统。

**核心功能**:
- ✅ **GDPR 合规**: 完全符合欧盟数据保护法规
- ✅ **苹果风格设计**: 毛玻璃效果，现代界面
- ✅ **智能地理位置检测**: 自动用户地理位置识别
- ✅ **无障碍支持**: 完整的键盘导航和屏幕阅读器支持
- ✅ **深色模式适配**: 自动适应系统深色偏好
- ✅ **多语言支持**: 国际化文本支持
- ✅ **用户偏好记忆**: 保存用户的Cookie选择

**特殊设计**:
- 智能隐藏中文用户（本地化合规）
- 平滑动画过渡效果
- 自定义样式和文案配置
- 优雅的毛玻璃背景效果

### 🔗 友情链接 (Simple FriendLink)
**版本**: 1.0.0

完整的友情链接管理和展示系统。

**核心功能**:
- ✅ **用户提交**: 登录用户可提交友情链接申请
- ✅ **管理员审核**: 完整的审核工作流程
- ✅ **分类系统**: 按自定义分类组织链接
- ✅ **搜索筛选**: 高级搜索和多维度筛选
- ✅ **卡片展示**: 响应式的卡片式布局
- ✅ **徽标上传**: 支持网站徽标和截图
- ✅ **评分系统**: 链接质量和体验评分

**特色功能**:
- 分页处理大量链接
- 多种短代码灵活集成
- 专用页面模板支持
- SEO友好的URL结构
- 自定义排序和显示选项

**使用方法**:
```php
// 显示所有友情链接
[simple_friendlink]

// 按分类显示
[simple_friendlink category="技术博客"]

// 显示网格布局
[simple_friendlink layout="grid"]

// 用户提交表单
[simple_friendlink_submit]
```

## 🏗️ 技术架构

### 模块化设计
```
wordpress-toolkit/
├── wordpress-toolkit.php          # 主插件文件
├── modules/                       # 功能模块目录
│   ├── custom-card/              # 网站卡片模块
│   ├── age-calculator/           # 年龄计算器模块
│   ├── time-capsule/             # 物品管理模块
│   ├── cookieguard/              # Cookie同意模块
│   └── simple-friendlink/        # 友情链接模块
├── assets/                       # 资源文件
│   ├── css/                      # 样式文件
│   │   ├── variables.css         # CSS变量系统
│   │   ├── common.css            # 通用样式组件
│   │   └── admin.css             # 管理界面样式
│   └── js/                       # JavaScript文件
│       ├── toolkit-core.js       # 核心JavaScript框架
│       ├── migration-helper.js   # 迁移助手
│       └── admin.js              # 管理界面脚本
├── includes/                     # 核心库
│   ├── class-admin-page-template.php # 页面模板系统
│   ├── class-logger.php          # 日志管理
│   └── i18n.php                  # 国际化支持
└── languages/                     # 语言文件
    └── wordpress-toolkit.pot
```

### 🎯 代码优化架构 (v1.0.4+)

**统一设计系统**:
- **CSS变量系统**: 统一的颜色、字体、间距规范
- **组件库**: 可重用的UI组件（按钮、表单、卡片、模态框等）
- **响应式框架**: 移动优先的响应式设计系统

**JavaScript核心框架**:
- **统一AJAX处理**: 标准化的API请求和响应处理
- **表单验证**: 自动化的表单验证和错误处理
- **通知系统**: 统一的消息提示和状态反馈
- **模态框管理**: 标准化的模态框交互系统

**开发工具**:
- **页面模板系统**: 标准化的管理页面开发模板
- **迁移助手**: 平滑的版本升级和代码迁移
- **自动化绑定**: 基于属性的自动事件绑定系统

### 统一管理界面
- **工具箱菜单**: 所有工具在统一的"工具箱"菜单下管理
- **权限级别**: 不同功能模块的不同用户权限
- **设置页面**: 每个模块都有独立的设置页面
- **快速导航**: 方便的功能说明和快速链接

## 🔒 安全功能

### 数据安全
- ✅ **SQL注入防护**: 所有数据库查询使用参数化查询
- ✅ **XSS防护**: 严格的输入数据清理和转义
- ✅ **CSRF防护**: 完整的nonce验证机制
- ✅ **文件操作安全**: 路径验证防止目录遍历攻击

### Cookie安全
- ✅ **安全标志**: 使用httponly、secure、samesite标志
- ✅ **地理位置安全**: 安全的IP地址检测和代理处理
- ✅ **用户隐私**: 不收集个人数据，本地数据存储

### 访问控制
- ✅ **权限检查**: 完整的用户权限验证
- ✅ **角色管理**: 管理员和订阅者权限分离
- ✅ **访问日志**: 安全的访问日志记录

### 代码安全
- ✅ **输入验证**: 所有用户输入经过严格验证
- ✅ **输出转义**: 防止代码注入和XSS攻击
- ✅ **错误处理**: 安全的错误消息处理
- ✅ **审计日志**: 调试模式控制的敏感日志记录

## ⚡ 性能优化

### 缓存系统
- **多级缓存**: 数据库 → Memcached → Opcache三级缓存
- **智能过期**: 自动缓存失效和更新检测
- **预加载**: 支持关键数据预加载
- **压缩优化**: CSS和JavaScript文件压缩

### 按需加载
- **模块化加载**: 仅加载已激活模块的资源
- **条件加载**: 根据页面类型加载相应资源
- **异步处理**: AJAX异步通信提升体验
- **懒加载**: 非关键资源延迟加载

### 代码优化
- **函数精简**: 移除所有冗余和未使用的代码（46%代码减少）
- **数据库优化**: 高效的数据库查询和索引设计
- **内存管理**: 防止内存泄漏和资源浪费
- **前端优化**: CSS和JavaScript代码优化（40%文件大小减少）

### 🚀 架构优化成果 (v1.0.4)

**代码冗余消除**:
- **CSS重复减少70%**: 统一的样式变量和组件库
- **JavaScript重复减少60%**: 共享的核心API框架
- **维护成本降低**: 统一的编码规范和开发流程

**性能提升**:
- **文件大小减少35-40%**: 优化的资源打包和压缩
- **HTTP请求减少30%**: 合并的资源加载策略
- **加载速度提升**: 更好的缓存和按需加载机制

**开发效率**:
- **统一API**: 标准化的AJAX、表单、通知处理
- **组件化**: 可重用的UI组件库
- **自动化**: 基于属性的事件绑定和表单处理
- **模板化**: 标准化的页面开发模板

## 🌐 国际化支持

### 多语言支持
- ✅ **文本域**: `wordpress-toolkit`
- ✅ **语言文件**: 标准.pot语言包
- ✅ **模块化翻译**: 每个模块独立翻译支持
- ✅ **本地化适配**: 支持日期和数字格式本地化

### 地区适配
- ✅ **中文用户**: Cookie通知的智能隐藏
- ✅ **时区支持**: 自动适应WordPress时区设置
- ✅ **货币格式**: 支持本地化货币显示
- ✅ **日期格式**: 符合地区习惯的日期显示

## 📱 响应式设计

### 设备兼容性
- ✅ **桌面**: 完整的桌面浏览器支持
- ✅ **平板**: 优化的平板显示效果
- ✅ **移动**: 完美的移动体验
- ✅ **触摸优化**: 触摸手势和交互优化

### 浏览器兼容性
- ✅ **现代浏览器**: Chrome、Firefox、Safari、Edge
- ✅ **移动浏览器**: iOS Safari、Chrome Mobile
- ✅ **渐进增强**: 旧版浏览器中的核心功能

## 🎨 UI/UX设计

### 设计原则
- **一致性**: 统一的设计语言和交互模式
- **简洁性**: 清晰直观的用户界面
- **无障碍**: WCAG 2.1 AA合规
- **性能**: 优先考虑加载速度和响应性能

### 主题兼容性
- ✅ **默认主题**: 与WordPress默认主题完美兼容
- ✅ **第三方主题**: 广泛的主题兼容性测试
- ✅ **自定义样式**: 支持主题样式覆盖
- ✅ **区块编辑器**: 与Gutenberg编辑器深度集成

## 📊 数据管理

### 数据存储
- **WordPress标准**: 使用WordPress标准数据库表结构
- **自定义表**: 高效的自定义数据表设计
- **数据备份**: 支持WordPress标准备份流程
- **数据迁移**: 提供数据导入导出功能

### 数据统计
- **访问统计**: 详细的访问和使用统计
- **用户行为**: 用户操作行为分析
- **性能监控**: 页面加载性能监控
- **错误跟踪**: 系统错误和异常记录

## 🚀 安装与配置

### 系统要求
- **WordPress**: 5.0或更高版本
- **PHP**: 7.4或更高版本
- **MySQL**: 5.6或更高版本
- **内存**: 最低64MB，推荐128MB

### 安装步骤

#### 方法1: 自动安装
1. 登录WordPress管理后台
2. 进入"插件" → "安装插件"
3. 搜索"WordPress Toolkit"
4. 点击"现在安装"并激活插件

#### 方法2: 手动安装
1. 下载插件zip文件
2. 进入WordPress管理后台
3. 进入"插件" → "安装插件" → "上传插件"
4. 选择zip文件并上传安装
5. 激活插件

### 初始配置
1. 激活插件后，进入"工具箱"菜单
2. 查看功能说明和快速导航
3. 根据需要配置各个工具模块
4. 在设置页面进行详细配置

## 🔧 管理界面

### 工具箱主菜单
- **功能说明**: 详细的模块功能介绍
- **快速导航**: 方便的模块快速访问
- **用户指南**: 每个模块的使用方法
- **配置建议**: 最佳配置建议

### 模块管理
- **网站卡片**: 卡片列表、缓存管理、设置配置
- **年龄计算器**: 计算器设置、显示配置、用户偏好
- **物品管理**: 物品列表、分类管理、统计分析
- **Cookie同意**: 样式配置、文本设置、行为配置
- **友情链接**: 链接审核、分类管理、用户提交

### 设置页面
- **网站卡片设置**: 缓存配置、抓取设置、显示选项
- **年龄计算器设置**: 默认格式、用户权限、显示配置
- **Cookie同意设置**: 样式选择、文本配置、地区设置
- **友情链接设置**: 审核规则、提交权限、显示配置

## 📈 使用场景

### 企业网站
- **网站卡片**: 显示合作伙伴和客户网站
- **友情链接**: 建立行业合作关系
- **Cookie同意**: 确保GDPR合规
- **物品管理**: 管理公司资产和设备

### 个人博客
- **年龄计算器**: 显示作者年龄或纪念日
- **友情链接**: 推荐优质博客和资源
- **Cookie同意**: 保护访客隐私
- **网站卡片**: 推荐相关网站和资源

### 电商平台
- **网站卡片**: 显示品牌和供应商
- **友情链接**: 展示合作伙伴和物流商
- **物品管理**: 管理库存和保修信息
- **Cookie同意**: 合规的Cookie管理

### 内容网站
- **网站卡片**: 丰富内容展示形式
- **友情链接**: 构建内容生态和合作
- **Cookie同意**: 隐私保护和合规
- **年龄计算器**: 增加互动性和趣味性

### 技术社区
- **友情链接**: 展示技术资源和工具
- **网站卡片**: 推荐技术文档和教程
- **年龄计算器**: 技术人员趣味功能
- **Cookie同意**: 隐私保护

## 🛠️ 开发信息

### 代码质量
- **编码标准**: 遵循WordPress编码标准
- **完整文档**: 详细的代码注释和文档
- **测试覆盖**: 核心功能测试覆盖
- **性能监控**: 持续的性能监控和优化

### 技术栈
- **后端**: PHP 7.4+, WordPress API, MySQL
- **前端**: HTML5, CSS3, JavaScript (jQuery)
- **CSS架构**: CSS变量、组件化设计系统
- **JavaScript架构**: 模块化框架、统一API
- **缓存**: Memcached, Opcache
- **安全**: Nonce验证、数据清理、权限控制

### 🎨 新架构特性

**CSS设计系统**:
```css
/* 统一的变量系统 */
:root {
  --tc-primary-color: #667eea;
  --tc-font-family: -apple-system, BlinkMacSystemFont;
  --tc-spacing-lg: 16px;
  /* ...更多变量 */
}

/* 可重用组件 */
.tc-btn { /* 统一按钮样式 */ }
.tc-card { /* 统一卡片样式 */ }
.tc-form-control { /* 统一表单样式 */ }
```

**JavaScript核心API**:
```javascript
// 统一的AJAX处理
ToolkitCore.ajax({
  data: { action: 'my_action' }
}).done(response => {
  ToolkitCore.showNotice('success', '操作成功');
});

// 自动表单处理
<form data-ajax-form="my_action">
  <!-- 自动验证和提交 -->
</form>

// 自动事件绑定
<button data-ajax-action="delete_item" data-confirm="确定删除？">
</button>
```

**PHP模板系统**:
```php
// 使用页面模板
$template = new Toolkit_Admin_Page_Template([
  'title' => '页面标题',
  'tabs' => [
    'tab1' => ['title' => '选项卡1', 'callback' => 'render_tab1']
  ]
]);
$template->render();
```

### 扩展性
- **钩子系统**: 完整的WordPress钩子支持
- **API接口**: 提供REST API接口
- **主题集成**: 与主题系统深度集成
- **插件兼容**: 与主流WordPress插件兼容

## 🔄 版本历史

### v1.0.4 (2025-10-29)
**架构重构更新**:
- 🏗️ **代码架构重构**: 统一的设计系统和开发框架
- 🎨 **CSS变量系统**: 统一的颜色、字体、间距规范
- ⚡ **JavaScript核心框架**: 标准化的AJAX、表单、通知处理
- 📋 **页面模板系统**: 标准化的管理页面开发模板
- 🔄 **迁移助手**: 平滑的版本升级和代码迁移
- 🔗 **友情链接模块**: 完整的友情链接管理系统
- ✨ **用户提交**: 允许登录用户提交友情链接
- 🏷️ **分类系统**: 按自定义分类组织链接
- 🔍 **搜索筛选**: 高级搜索和筛选功能
- 📱 **响应式设计**: 链接的卡片式布局展示

**架构优化成果**:
- **代码冗余消除**: CSS重复减少70%，JavaScript重复减少60%
- **性能提升**: 文件大小减少35-40%，HTTP请求减少30%
- **开发效率**: 统一API、组件化、自动化处理
- **向后兼容**: 完全保持现有功能和UI不变
- **质量提升**: 统一编码规范，更好的可维护性

**技术特点**:
- 管理员审核工作流程用户提交
- 支持徽标、描述和评分
- 处理大量链接的分页
- 多个短代码实现灵活集成
- 专用页面模板

### v1.0.3 (2025-10-23)
**重大更新**:
- 🎨 **UI统一**: 后台管理界面风格统一优化
- 🧹 **代码清理**: 清理冗余代码，46%代码减少
- ⚡ **性能提升**: CSS和JS文件大小减少40%
- 🔒 **安全增强**: 修复函数重声明问题
- 📱 **响应式优化**: 移动体验改进

**技术改进**:
- 统一的后台管理界面样式
- 优化物品管理表格布局
- 清理未使用的函数和样式
- 修复PHP语法错误
- 改进错误处理机制

### v1.0.2
**安全版本**:
- 🛡️ 修复SQL注入漏洞
- 🔒 增强文件操作安全
- 🍪 改进Cookie安全设置
- 🌐 优化IP地址处理
- 📝 完成日志系统

### v1.0.0
**初始发布**:
- 🎉 集成四个核心工具模块
- 🎨 统一管理界面设计
- ⚡ 性能和缓存机制优化
- 🔒 增强安全和数据保护
- 🌍 完整的国际化支持

## ❓ 常见问题

### Q: 这个插件包括哪些工具？
A: WordPress Toolkit包括五个核心工具：
1. **网站卡片** - 自动抓取网站元数据
2. **年龄计算器** - 精确计算年龄
3. **物品管理** - 物品管理和保修追踪
4. **Cookie同意** - GDPR合规的Cookie通知
5. **友情链接管理** - 完整的友情链接管理和展示系统

### Q: 我可以单独使用各个工具吗？
A: 是的，每个工具都是独立的模块。你可以根据需要启用或禁用相应的模块，不会影响其他功能。

### Q: 插件会影响网站性能吗？
A: 不会。插件采用模块化设计，按需加载资源，并使用智能缓存机制来最小化对网站性能的影响。

### Q: 支持多语言吗？
A: 是的，插件支持多语言和本地化。你可以根据需要翻译成任何语言。

### Q: 与所有主题兼容吗？
A: 是的，插件与所有WordPress主题兼容，包括自定义主题。

### Q: 如何获得技术支持？
A: 如需技术支持，请访问: https://www.saiita.com.cn

## 👨‍💻 开发者指南

### 🎯 新架构开发指南

**CSS开发**:
```css
/* 使用CSS变量 */
.my-component {
  background: var(--tc-bg-primary);
  color: var(--tc-text-primary);
  padding: var(--tc-spacing-lg);
  border-radius: var(--tc-radius-lg);
}

/* 使用通用组件 */
.my-form {
  /* 使用 tc-form-group, tc-form-control 等类 */
}
```

**JavaScript开发**:
```javascript
// 扩展核心框架
var MyModule = $.extend({}, ToolkitCore, {
  init: function() {
    this.bindEvents();
  },

  customAction: function() {
    this.ajax({
      data: { action: 'my_custom_action' }
    }).done(response => {
      this.showNotice('success', '操作成功');
    });
  }
});
```

**PHP开发**:
```php
// 使用页面模板
$template = new Toolkit_Admin_Page_Template([
  'title' => '我的模块',
  'tabs' => [
    'settings' => [
      'title' => '设置',
      'callback' => [$this, 'render_settings']
    ]
  ]
]);
$template->render();
```

### 🔧 扩展开发

**创建新模块**:
1. 在 `modules/` 目录下创建模块文件夹
2. 实现标准的模块类结构
3. 使用统一的样式和JavaScript框架
4. 遵循WordPress编码规范

**最佳实践**:
- 使用统一的CSS变量和组件类
- 使用ToolkitCore进行AJAX和表单处理
- 实现适当的安全检查和权限验证
- 添加详细的代码注释和文档

### 📚 更多资源

- **优化总结**: [OPTIMIZATION_SUMMARY.md](OPTIMIZATION_SUMMARY.md)
- **代码示例**: 各模块中的实际代码示例
- **API文档**: 核心框架的完整API文档

## 🔗 相关链接

- **插件主页**: https://www.saiita.com.cn
- **技术支持**: https://www.saiita.com.cn/support
- **文档中心**: https://www.saiita.com.cn/docs
- **GitHub仓库**: [项目仓库链接]

## 📄 许可证

本插件在GPLv2或更高版本许可证下发布。

```
WordPress Toolkit
Copyright (C) 2025 www.saiita.com.cn

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
```

---

**WordPress Toolkit** - 让WordPress网站更强大！🚀